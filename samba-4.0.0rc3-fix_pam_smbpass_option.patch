commit fb3cf6c24270d22dad8ac9a1c12e8d77c8189f11
Author:     Andreas Schneider <asn@samba.org>
AuthorDate: Tue Oct 2 14:25:40 2012 +0200
Commit:     Andreas Schneider <asn@samba.org>
CommitDate: Thu Oct 4 10:20:35 2012 +0200

    waf: Build pam_smbpass module only if enabled.
---
 source3/pam_smbpass/wscript_build | 3 ++-
 source3/wscript                   | 3 +++
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/source3/pam_smbpass/wscript_build b/source3/pam_smbpass/wscript_build
index 70b21d5..a2a2d01 100644
--- a/source3/pam_smbpass/wscript_build
+++ b/source3/pam_smbpass/wscript_build
@@ -10,5 +10,6 @@ if bld.CONFIG_SET('WITH_PAM_MODULES'):
                 LIBNTLMSSP LIBTSOCKET''',
         cflags='-DLOCALEDIR=\"%s/locale\"' % bld.env.DATADIR,
         realname='pam_smbpass.so',
-        install_path='${PAMMODULESDIR}'
+        install_path='${PAMMODULESDIR}',
+        enabled=bld.env.with_pam_smbpass
         )
diff --git a/source3/wscript b/source3/wscript
index 765f761..e4898ef 100644
--- a/source3/wscript
+++ b/source3/wscript
@@ -762,6 +762,9 @@ int i; i = PAM_RADIO_TYPE;
             conf.DEFINE('WITH_PAM', 1)
             conf.DEFINE('WITH_PAM_MODULES', 1)
 
+    if Options.options.with_pam_smbpass:
+        conf.env.with_pam_smbpass = True
+
     seteuid = False
 
 #
